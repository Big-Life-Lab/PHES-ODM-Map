meta:
    title: ODM 2.0 Long to Wide
    version: 0.0.1
    author: Martin Wellman
    contact: mwellman@ohri.ca
    links: https://phes-odm.org
    last_modified: 2023-12-18

tables:
    -   output_table: measures
        main_inputs:
            input_table: measures
            group_by: [ date, sampleID ]
        other_inputs:
            -   input_table: samples
                match: 
                    # Include rows in samples table where samples["sampleID"] == measures["sampleID"]
                    input_column: [ date, sampleID ]
                    match_table: measures
                    match_column: [ date, sampleID ]
            -   input_table: contacts
                match:
                    # Include rows in contacts table where contacts["contactID"] == measures["contactID"]
                    input_column: contactID
                    match_table: measures
                    match_column: contactID
        operations:
            -   operation: pivot_wider
                operation_config:
                    target_column_sources: [ compartment, specimen, fraction_analysed, measure, unit, aggregation, index ]
                    target_column_separator: _
                    target_column_suffix: _value
                    source_table: measures
                    source_column: value
            -   operation: copy
                operation_config:
                    target_column: mr_reportDate
                    source_table: measures
                    source_column: reportDate
            -   operation: copy
                operation_config:
                    target_column: [ sm_siteID, sm_sampleMat, co_contactID ]
                    source_table: [ samples, samples, contacts ]
                    source_column: [ siteID, saMaterial, contactID ]
        post_operations:
            -   operation: order_columns
                operation_config:
                    column_order_regex: [ mr_reportDate, sm_siteID, sm_sampleMat, co_contactID, compartment, specimen, fraction_analysed, measure, unit, aggregation, index, .* ]
            -   operation: sort_rows
                operation_config:
                    sort_by: [ mr_reportDate, sm_siteID, measure, index ]